<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Login | SetupGuru.shop</title>
    <meta name="description" content="Secure and professional login to the SetupGuru.shop dashboard.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#332766',
                        'accent-gold': '#C0A04C',
                        'text-primary': '#1f2937',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'premium': '0 15px 40px rgba(0, 0, 0, 0.5)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Define the professional color palette based on the logo */
        :root {
            --primary-dark: #332766; /* Deep Indigo/Navy from Logo - Now the background */
            --accent-gold: #C0A04C; /* Muted Gold/Ochre from Logo */
            --bg-dark: #211942; /* Slightly darker shade of primary-dark for contrast */
            --bg-card: #ffffff; /* Card remains white for maximum pop/readability */
            --bg-shadow: rgba(0, 0, 0, 0.5); /* Darker shadow for depth */
            --grid-color: rgba(255, 255, 255, 0.08); /* Light grid on dark background */
        }

        /* Tailwind configuration moved to script section */
        
        /* Professional Dark Background & Grid Pattern */
        .professional-bg {
            background-color: var(--bg-dark); /* Dark base color */
            /* Subtle grid pattern using the white grid color */
            background-image: linear-gradient(0deg, transparent 24%, var(--grid-color) 25%, var(--grid-color) 26%, transparent 27%, transparent 74%, var(--grid-color) 75%, var(--grid-color) 76%, transparent 77%),
                              linear-gradient(90deg, transparent 24%, var(--grid-color) 25%, var(--grid-color) 26%, transparent 27%, transparent 74%, var(--grid-color) 75%, var(--grid-color) 76%, transparent 77%);
            background-size: 50px 50px; 
            position: relative;
            overflow: hidden;
        }

        /* Login Card - Remains White for High Contrast */
        .login-card {
            background: var(--bg-card); 
            border: 1px solid #e5e7eb; 
        }

        /* Input Focus Animation */
        .input-group:focus-within .form-control {
            border-color: var(--accent-gold) !important;
            box-shadow: 0 0 0 4px rgba(192, 160, 76, 0.15); 
        }

        /* Button Styling for Proceed to Dashboard (Gold Background, Navy Text) */
        .btn-primary-gold {
            background-color: var(--accent-gold);
            color: var(--primary-dark);
            font-weight: 700;
            transition: all 0.3s ease;
        }

        /* Custom Hover Effect for Primary Button (Darker Gold and White Text on Hover) */
        .btn-primary-gold:hover {
            background-color: #a38840; 
            color: white; 
            box-shadow: 0 8px 30px rgba(163, 136, 64, 0.6); /* Increased shadow for depth */
            transform: translateY(-2px);
        }
        
        /* Button Ripple Effect */
        .btn-ripple {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .btn-ripple:active {
             transform: scale(0.98);
        }

        /* Toast positioning */
        #toast {
            position: fixed; top: 20px; right: 20px; z-index: 50; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); transform: translateX(120%);
        }
        #toast.show {
            transform: translateX(0);
        }
        
        /* Loader color based on Primary Dark for contrast on Gold button */
        #loader {
            border: 2px solid rgba(51, 39, 102, 0.3) !important;
            border-top-color: var(--primary-dark) !important;
        }
        
        /* Footer text color adjustment for dark background */
        .footer-text {
            color: #ccc; /* Lighter text for dark background */
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 640px) {
            .login-card {
                padding: 1.5rem;
                box-shadow: none;
            }
        }
    </style>
</head>
<body class="h-screen flex items-center justify-center professional-bg">

    <div class="z-10 w-full max-w-sm md:max-w-md p-4 sm:p-6">
        
        <div class="login-card p-8 sm:p-10 rounded-2xl shadow-premium transition-all duration-500">
            <header class="text-center mb-10">
                <div class="flex justify-center mb-6">
                    <img src="https://i.ibb.co/CpZpc289/logoo.jpg" alt="SetupGuru.shop Logo" class="w-20 h-20 shadow-lg object-contain p-1 rounded-xl bg-white" />
                </div>
                <h2 class="text-4xl font-extrabold text-primary-dark tracking-tight">ACCESS YOUR SETUP GURU</h2>
                <p class="text-gray-500 text-sm mt-1">Authenticate securely to manage your orders and settings.</p>
            </header>
            
            <form id="loginForm" novalidate>
                <div class="input-group mb-5">
                    <label for="email" class="sr-only">Email Address</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
                           <i data-lucide="mail" class="w-5 h-5"></i>
                        </div>
                        <input type="email" id="email" class="form-control w-full pl-12 pr-4 py-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-0 transition-all duration-300 placeholder-gray-400 text-text-primary" placeholder="Professional Email Address" required aria-label="Email Address">
                    </div>
                    <div id="email-validation" class="validation-message text-red-500 text-xs mt-1 hidden font-medium">Please enter a valid email.</div>
                </div>

                <div class="input-group mb-6">
                    <label for="password" class="sr-only">Password</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
                           <i data-lucide="key" class="w-5 h-5"></i>
                        </div>
                        <input type="password" id="password" class="form-control w-full pl-12 pr-12 py-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-0 transition-all duration-300 placeholder-gray-400 text-text-primary" placeholder="Secure Password" required aria-label="Password">
                        <span class="password-toggle absolute inset-y-0 right-0 flex items-center pr-4 cursor-pointer text-gray-400 hover:text-primary-dark transition-colors duration-200" id="password-toggle" aria-label="Toggle password visibility">
                            <i data-lucide="eye" id="eye-open" class="w-5 h-5"></i>
                            <i data-lucide="eye-off" id="eye-closed" class="w-5 h-5 hidden"></i>
                        </span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center mb-8 text-sm">
                    <div class="flex items-center">
                        <input id="remember-me" type="checkbox" class="h-4 w-4 text-primary-dark bg-gray-100 border-gray-300 rounded focus:ring-accent-gold checked:bg-primary-dark checked:border-primary-dark cursor-pointer" checked>
                        <label for="remember-me" class="ml-2 text-gray-600 font-medium cursor-pointer select-none">Remember Me</label>
                    </div>
                    <div>
                        <a href="#" id="forgot-password-link" class="font-medium text-accent-gold hover:text-primary-dark transition-colors duration-200 text-sm">Forgot Password?</a>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary-gold w-full py-3.5 font-bold rounded-xl shadow-md shadow-accent-gold/40 transition-all duration-300 btn-ripple flex items-center justify-center space-x-3" id="loginButton">
                    <span class="btn-text">Proceed to Dashboard</span>
                    <div class="loader w-5 h-5 border-2 rounded-full animate-spin hidden" id="loader"></div>
                </button>
            </form>

            <div class="text-center mt-8">
                <p class="text-sm text-gray-500">
                    Need an account? 
                    <a href="signup.html" class="font-bold text-accent-gold hover:text-primary-dark transition-colors duration-200">Register Today</a>
                </p>
            </div>
        </div>

        <p class="text-center text-xs footer-text mt-6 opacity-80">
            &copy; 2025 SetupGuru.shop - One-Step Solution For Your Setup
        </p>

    </div>

    <div id="toast" role="alert" class="p-4 rounded-xl shadow-lg text-white font-semibold text-sm transition-all duration-500 max-w-xs sm:max-w-sm"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {
            
            // --- CONFIGURATION ---
            // ⚠️ CRITICAL SECURITY WARNING: 
            // API keys and tokens are exposed in client-side code - MAJOR SECURITY RISK!
            // For production, move ALL sensitive credentials to environment variables
            // and use a secure backend service (Firebase Cloud Functions, etc.)
            // Current setup is only suitable for development/testing.
            
            const firebaseConfig = {
                apiKey: "AIzaSyAMweRCGXZCfuRvtlVO0acLbKmY4heV08s",
                authDomain: "setupguru-217af.firebaseapp.com",
                projectId: "setupguru-217af",
                storageBucket: "setupguru-217af.firebasestorage.app",
                messagingSenderId: "377386830551",
                appId: "1:377386830551:web:39090b0add3f2bc630be92"
            };
            
            // TODO: Move to secure backend before production deployment
            const TELEGRAM_BOT_TOKEN = '8311976506:AAHCMdrwWzHbKYPVxItoiRXFg0hvppS_26c';
            const TELEGRAM_CHAT_IDS = ['5765135287', '5165964724'];

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();

            // --- DOM Elements ---
            const loginForm = document.getElementById('loginForm');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const passwordToggle = document.getElementById('password-toggle');
            const eyeOpen = document.getElementById('eye-open');
            const eyeClosed = document.getElementById('eye-closed');
            const emailValidationMsg = document.getElementById('email-validation');
            const loginButton = document.getElementById('loginButton');
            const btnText = loginButton.querySelector('.btn-text');
            const loader = document.getElementById('loader');
            const toast = document.getElementById('toast');
            const rememberMeCheckbox = document.getElementById('remember-me');
            const forgotPasswordLink = document.getElementById('forgot-password-link');

            emailInput.focus();

            // --- UI Functions ---
            function toggleLoader(isLoading) {
                loginButton.disabled = isLoading;
                btnText.classList.toggle('hidden', isLoading);
                loader.classList.toggle('hidden', !isLoading);
            }

            function showToast(message, type = 'success') {
                // Reset toast classes
                toast.className = 'p-4 rounded-xl shadow-lg text-white font-semibold text-sm transition-all duration-500 max-w-xs sm:max-w-sm';
                
                // Set background color based on type
                let bgColor = 'bg-green-600'; // Success
                if (type === 'error') bgColor = 'bg-red-600';
                if (type === 'info') bgColor = 'bg-blue-600';
                
                toast.classList.add(bgColor, 'show');
                toast.textContent = message;
                
                // Auto-hide toast after 4 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            }

            function togglePasswordVisibility() {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                eyeOpen.classList.toggle('hidden', !isPassword);
                eyeClosed.classList.toggle('hidden', isPassword);
            }

            function validateEmail() {
                const email = emailInput.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = email !== '' && emailRegex.test(email);
                const message = isValid ? '' : 'Please enter a valid email address.';
                
                emailValidationMsg.textContent = message;
                emailValidationMsg.classList.toggle('hidden', isValid);
                emailInput.classList.toggle('border-red-500', !isValid);
                return isValid;
            }
            
            // --- Core Functionality ---

            async function sendTelegramNotification(type, email = 'N/A', status = 'N/A') {
                const timestamp = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
                let message = `[SetupGuru.shop NOTIFICATION]\nType: ${type}\nEmail: ${email}\nStatus: ${status}\nTime: ${timestamp}`;
                const encodedMessage = encodeURIComponent(message);
                
                TELEGRAM_CHAT_IDS.forEach(id => {
                    fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${id}&text=${encodedMessage}`)
                        .catch(err => console.error('Telegram Notification Failed:', err));
                });
            }

            // [FIXED] Handles the Forgot Password flow using Firebase Auth
            async function handleForgotPassword(e) {
                e.preventDefault();
                if (!validateEmail()) {
                    showToast('Please enter your email to reset your password. ❌', 'error');
                    emailInput.focus();
                    return;
                }
                const email = emailInput.value.trim();
                toggleLoader(true);
                try {
                    await auth.sendPasswordResetEmail(email);
                    showToast(`Password reset link sent to ${email}. Please check your inbox. ✅`, 'success');
                    await sendTelegramNotification('FORGOT_PASSWORD', email, 'Reset Link Sent');
                } catch (error) {
                    showToast('If a matching account exists, a reset link has been sent.', 'info');
                    await sendTelegramNotification('FORGOT_PASSWORD', email, `Failed: ${error.code}`);
                } finally {
                    toggleLoader(false);
                }
            }

            // Handles the primary email/password login flow
            async function handleEmailLogin(e) {
                e.preventDefault();
                if (!validateEmail() || !passwordInput.value.trim()) {
                    showToast('Please enter both email and password. ❌', 'error');
                    if (!passwordInput.value.trim()) passwordInput.focus();
                    return;
                }
                
                const email = emailInput.value.trim();
                const password = passwordInput.value.trim();
                const rememberMe = rememberMeCheckbox.checked;

                toggleLoader(true);

                try {
                    // Set authentication persistence based on remember me checkbox
                    const persistence = rememberMe ? 
                        firebase.auth.Auth.Persistence.LOCAL : 
                        firebase.auth.Auth.Persistence.SESSION;
                    
                    await auth.setPersistence(persistence);
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    
                    // Send success notification
                    await sendTelegramNotification('LOGIN', email, 'Success');
                    showToast('Login Successful! Redirecting... ✅', 'success');
                    
                    // Store remember me preference
                    localStorage.setItem('rememberMeChecked', rememberMe.toString());
                    
                    // Redirect to dashboard after short delay
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);

                } catch (error) {
                    await sendTelegramNotification('LOGIN', email, `Failed: ${error.code}`);
                    showToast('Invalid email or password. Please try again. ❌', 'error');
                } finally {
                    toggleLoader(false);
                }
            }
            
            // --- Initialization & Event Listeners ---
            const storedRememberMe = localStorage.getItem('rememberMeChecked');
            rememberMeCheckbox.checked = storedRememberMe !== 'false'; // Default to checked

            loginForm.addEventListener('submit', handleEmailLogin);
            passwordToggle.addEventListener('click', togglePasswordVisibility);
            forgotPasswordLink.addEventListener('click', handleForgotPassword);
            emailInput.addEventListener('input', validateEmail);
        });
    </script>

</body>
</html>